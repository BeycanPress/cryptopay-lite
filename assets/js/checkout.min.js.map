{"version":3,"sources":["checkout.js"],"names":["$","document","ready","let","startedApp","handleUnloadEvent","navigator","userAgent","indexOf","documentMode","e","preventDefault","printError","errorMessage","scrollElement","remove","$form","prepend","removeClass","unblock","find","trigger","length","animate","scrollTop","offset","top","body","async","checkFormProcess","network","currency","init","data","serialize","params","CryptoPayLiteVars","res","cplHelpers","removeNoNeededParams","JSON","stringify","await","Promise","ajax","type","dataType","url","wc_checkout_params","checkout_url","success","response","window","off","store","payment","setInit","resolve","reload","location","refresh","message","messages","CryptoPayLiteLang","defaultErrorMsg","buttonProcess","CryptoPayLiteApp","modal","close","error","jqXHR","textStatus","errorThrown","complete","closePopup","dynamicData","add","wcForm","formToObj","CryptoPayLiteConfig","events","ctx","disableAutoQr","waitingPopup","checkingForm","order","paymentCurrency","Object","assign","on","open","reStart","start","jQuery"],"mappings":"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","file":"checkout.min.js","sourcesContent":[";(($) => {  \n    $(document).ready(() => {\n        // CryptoPay JS App\n        let startedApp;\n\n        $form = $('form.checkout');\n\n        function handleUnloadEvent() {\n            if((navigator.userAgent.indexOf('MSIE') !== -1 ) || (!!document.documentMode)) {\n                // IE handles unload events differently than modern browsers\n                e.preventDefault();\n                return undefined;\n            }\n\n            return true;\n        }\n\n        function scrollToNotices() {\n            var scrollElement = $('.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout');\n    \n            if ( ! scrollElement.length ) {\n                scrollElement = $form;\n            }\n            \n            if ( scrollElement.length ) {\n                $( 'html, body' ).animate( {\n                    scrollTop: ( scrollElement.offset().top - 100 )\n                }, 1000 );\n            }\n        }\n\n        function printError(errorMessage) {\n            $('.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message').remove();\n            $form.prepend('<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + errorMessage + '</div>');\n            $form.removeClass('processing').unblock();\n            $form.find('.input-text, select, input:checkbox').trigger('validate').trigger('blur');\n            scrollToNotices();\n            $(document.body).trigger('checkout_error' , [errorMessage]);\n        }\n\n        async function checkFormProcess(network, currency, init = true) {\n            let data = $form.serialize();\n            const params = CryptoPayLiteVars.params || {};\n            network = cplHelpers.removeNoNeededParams(network);\n            \n            data += '&cp_init=' + init;\n            data += '&cp_params=' + JSON.stringify(params);\n            data += '&cp_network=' + JSON.stringify(network);\n            data += '&cp_currency=' + JSON.stringify(currency);\n\n            let res = await new Promise((resolve) => {\n                $.ajax({\n                    data: data,\n                    type: 'POST',\n                    dataType: 'json',\n                    url: wc_checkout_params.checkout_url,\n                    success:\tfunction(response) {\n                        $(window).off('beforeunload', handleUnloadEvent);\n\n                        if (response.success) {\n                            $(\".woocommerce-NoticeGroup-checkout\").remove();\n                            if (response.data && response.data.init) {\n                                startedApp.store.payment.setInit(response.data.init);\n                            }\n                            resolve(null);\n                        } else {\n                            if (response.data) {\n                                if (true === response.data.reload) {\n                                    window.location.reload();\n                                    return;\n                                }\n    \n                                if (true === response.data.refresh) {\n                                    $(document.body).trigger('update_checkout');\n                                }\n                            }\n\n                            if (response.message || response.messages) {\n                                printError(response.message ? response.message : response.messages);\n                            } else {\n                                printError('<div class=\"woocommerce-error\">' + CryptoPayLiteLang.defaultErrorMsg + '</div>'); \n                            }\n\n                            if (CryptoPayLiteVars.buttonProcess) {\n                                CryptoPayLiteApp.modal?.close();\n                            }\n\n                            resolve({error: true});\n                        }\n                    },\n                    error:\tfunction(jqXHR, textStatus, errorThrown) {\n                        $(window).off('beforeunload', handleUnloadEvent);\n\n                        printError(\n                            '<div class=\"woocommerce-error\">' +\n                            (errorThrown || CryptoPayLiteLang.defaultErrorMsg) +\n                            '</div>'\n                        );\n\n                        if (CryptoPayLiteVars.buttonProcess) {\n                            CryptoPayLiteApp.modal?.close();\n                        }\n\n                        resolve({\n                            error: true,\n                        });\n                    },\n                    complete: function() {\n                        cplHelpers.closePopup();\n                        CryptoPayLiteApp.dynamicData.add({\n                            wcForm: cplHelpers.formToObj('form.checkout')\n                        });\n                    }\n                });\n            });\n\n            return res;\n        }\n\n        if (CryptoPayLiteConfig.init) {\n            CryptoPayLiteApp.events.add('init', async (ctx) => {\n                ctx.disableAutoQr = true;\n            }, 'wc_checkout');\n            CryptoPayLiteApp.events.add('payNow', (ctx) => {\n                cplHelpers.waitingPopup(CryptoPayLiteLang.checkingForm);\n                return checkFormProcess(ctx.network, ctx.order.paymentCurrency, false);\n            }, 'wc_checkout');\n        } else {\n            CryptoPayLiteApp.events.add('init', async (ctx) => {\n                ctx = Object.assign(ctx, (await checkFormProcess(ctx.network, ctx.currency)));\n            }, 'wc_checkout');\n        }\n    \n        if (CryptoPayLiteVars.buttonProcess) {\n            $(document).on('click', '#cryptopay_lite_modal', CryptoPayLiteApp.modal?.open);\n        }\n\n        $(document).on('updated_checkout', function () {\n            if (!startedApp) {\n                startedApp = CryptoPayLiteApp.start(CryptoPayLiteVars.order);\n            } else {\n                startedApp.reStart(CryptoPayLiteVars.order);\n            }\n        });\n    \n        $('form.checkout').on('change', 'input[name=\"payment_method\"]', function() {\n            $(document.body).trigger('update_checkout');\n        });\n    });\n})(jQuery);"]}